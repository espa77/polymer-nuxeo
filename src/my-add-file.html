<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/iron-input/iron-input.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="shared-styles.html">

<dom-module id="my-add-file">

    <template>

        <style include="shared-styles">
            :host {
                display: block;
                padding: 10px;
            }
            paper-button.add-new {
                margin: 2ch;
            }
        </style>

        <div class="card">
            <div class="title">New File</div>
            <nuxeo-resource id="nuxeo" contentType="application/json" path="path/default-domain/UserWorkspaces/esteiner" on-response="handleResponse"></nuxeo-resource>
            <form is="iron-form" id="form" action="" content-type="application/json">
                <h3>Entity Type: Document</h3>
                <h3>Type: File</h3>
                <label>File Name:</label>
                <input name="name" type="text" required>

                <paper-button class="add-new" raised on-tap="openProps">ADD PROPERTIES</paper-button>
                <paper-button class="add-new" raised on-tap="submitFileForm">CREATE</paper-button>
                <div id="properties">
                <template is="dom-if" if="{{showProperties}}">
                    <label>Title:</label>
                    <input name="title" type="text">
                    <label>Description:</label>
                    <input name="description" type="text">
                </template>
                </div>
            </form>
        </div>
        <paper-dialog id="contentSuccess"
                      entry-animation="scale-up-animation"
                      exit-animation="fade-out-animation">

            <template is="dom-if" if="{{showResponse}}">
                <h2>Your File Has Been Uploaded</h2>
                <a href="/root">
                    <paper-button raised noink class="new">VIEW FOLDER</paper-button>
                </a>
                <paper-button raised noink class="new" on-tap="addNewFile">ADD NEW FILE</paper-button>
            </template>
            <div class="buttons">
                <paper-button dialog-dismiss>Cancel</paper-button>
            </div>
        </paper-dialog>

    </template>

    <script>

        Polymer({

            is: 'my-add-file',

            showProperties: false,

            showResponse: false,

            openProps: function() {
                this.set('showProperties', true);
            },
            submitFileForm() {
                if (this.$.form.name.value) {
                    var urlStub = this.$.form.name.value,
                            data = {
                                "entity-type": "document",
                                "type": "File"
                            };
                    if (this.$.form.title.value || this.$.form.description.value) {
                        data = {
                            "name": urlStub,
                            "properties": {
                                "dc:title": this.$.form.title.value,
                                "dc:description": this.$.form.description.value
                            }
                        }
                    } else {
                        data = {
                            "name": this.$.form.name.value
                        }
                    }
                } else {
                    alert("please provide a name for this new file");
                    return false;
                }
                data = JSON.stringify(data);
                this.$.nuxeo.setAttribute("data", data);
                this.$.nuxeo.post();
            },
            handleResponse: function(success) {
                this.$.form.reset();
                this.$.nuxeo.removeAttribute("data");
                if (success.returnValue === true) {
                    this.set('showResponse', true);
                } else {
                    alert("there was a problem creating your new file");
                }
            },
            addNewFile() {
                this.set('showResponse', false)
            }
        });

    </script>

</dom-module>

<script>

</script>
