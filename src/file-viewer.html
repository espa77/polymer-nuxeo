<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/nuxeo-elements/nuxeo-document.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">

<dom-module id="file-viewer">

    <template>
        <style include="shared-styles">
            :host {
                display: block;
            }
            h3 {
                margin-bottom: 0;
            }
            paper-button a {
                text-decoration: none;
            }
        </style>
        <body>
            <nuxeo-document auto doc-id="[[uid]]" on-response="filePreview" enrichers="thumbnail"></nuxeo-document>
            <h3>Title: {{fileTitle}}</h3>
            <span id="container"></span>
            <template is="dom-if" if="{{imageAttributes}}">
                <p>Original Height: [[height]]px</p>
                <p>Original Width: [[width]]px</p>
                <p>Original Format: [[format]]</p>
                <p>Original Size: [[fileSize]]</p>
            </template>
            <template is="dom-if" if="{{image}}">
                <iron-image id="test" preload fade src="[[thumbUrl]]" width="90%" style="background-color: lightgray;"></iron-image><br>
                <paper-button raised><a href="[[fileDataPath]]">DOWNLOAD ORIGINAL</a></paper-button>
            </template>
        </body>
    </template>

    <script>

        Polymer({

            is: 'file-viewer',

            imageAttributes: false,
            image: false,

            properties: {
                fileDataPath: {
                    type: String
                },
                thumbUrl: {
                    type: String
                },
                fileTitle: {
                    type: String
                },
                height: {
                    type: String
                },
                width: {
                    type: String
                },
                format: {
                    type: String
                },
                fileSize: {
                    type: String
                }

            },

            filePreview: function(event, object) {
                if (object.response.type === "Picture" || object.response.type === "File") {
                    this.imagePreview(object);
                }
                if (object.response.type === "Note") {
                    this.notePreview(object);
                }
            },

            imagePreview: function(object) {
                this.image = true;
                this.fileDataPath = object.response.properties["file:content"].data;
                this.fileSize = object.response.properties["common:size"];
                this.fileTitle = object.response.title;
                this.thumbUrl = object.response.contextParameters.thumbnail.url;
                if (object.response.properties["picture:info"]) {
                    this.height = object.response.properties["picture:info"].height;
                    this.width = object.response.properties["picture:info"].width;
                    this.format = object.response.properties["picture:info"].format;
                    this.imageAttributes = true;
                } else {
                    this.imageAttributes = false;
                }
            },

            notePreview: function(object) {
                let note = object.response.properties["note:note"],
                    mimeType = object.response.properties["note:mime_type"],
                    noteName = object.response.properties["dc:title"];
                this.note = note;
                this.mimeType = mimeType;
                this.fileName = noteName;
            }
        });

    </script>

</dom-module>