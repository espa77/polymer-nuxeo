<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/sc-timeago/sc-timeago.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../bower_components/iron-input/iron-input.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="shared-styles.html">

<dom-module id="my-root">

    <template>

        <style include="iron-flex iron-flex-alignment">

        </style>

        <style include="shared-styles">
            :host {
                display: block;
                padding: 10px;
            }
            .container {
                @apply(--layout-vertical);
                border: 2px solid #9C27B0;
                border-radius: 5px;
                background: no-repeat top center url("../images/folder-icon.png") #E1BEE7;
            }
            .sub-container {
                @apply(--layout-vertical);
            }
            .sub-container h3 {
                margin-bottom: 0.1em;
                margin-top: 0.1em;
                padding-left: 2ch;
                text-shadow: rgba(255,255,255,1) 1px 1px 2px;
            }
            .folder-title {
                text-align: center;
                font-size: 22px;
                font-weight: 700;
                text-shadow: rgba(255,255,255,1) 1px 1px 10px;
                padding-top: 1.8em;
            }
            .contents-text {
                text-align: center;
                font-size: 24px;
                font-weight: 100;
                padding-top: 4em;
                margin-bottom: 0;
            }
            .folder-list, .file-list {
                @apply(--layout-horizontal);
                @apply(--layout-around-justified);
                @apply(--layout-wrap);
            }
            .folders, .files {
                width: 20%;
                min-width: 130px;
                text-align: center;
                border: 1px solid #F3E5F5;
                border-radius: 5px;
            }
            .folders {
                background: no-repeat top/40% url("../images/folder-icon.png") rgba(255, 255, 255, 0.1);
                padding-top: 5ch;
                margin-top: 0.5ch;
            }
            .folders:hover, .files:hover {
                border: 1px solid #E040FB;
                background-color: rgba(255, 255, 255, 0.4);
            }
            .files {
                padding-top: 1ch;
                padding-bottom: 1ch;
            }
            #file-title {
                border-top: 1px solid #E040FB;
                margin-top: 1.5ch;
                padding-top: 0.5ch;
            }
            .title {
                text-align: center;
            }
            .create-new-content {
                @apply(--layout-horizontal);
                @apply(--layout-center-justified);
                padding-top: 1.5ch;
                border-top: 1px solid #E040FB;
                margin-top: 2ch;
            }
            .create-new-content paper-button {
                background-color: #E040FB;
                color: #EEE;
                margin-bottom: 2ch;
                margin-top: 0.5ch;
            }
            .create-new-content paper-button:hover {
                color: #111;
            }
            .title {
                font-weight: 500;
            }
            paper-dialog {
                padding-top: 2em;
            }
            paper-dialog a {
                text-decoration: none;
                color: #757575;
            }
        </style>

        <app-route
                route="{{route}}"
                pattern="/:view"
                data="{{routeData}}"></app-route>
        <nuxeo-resource auto id="data-for-route" url="{{_folderView(routeData.view)}}" on-response="handleResponse" ></nuxeo-resource>

        <div class="container">
            <h1 class="folder-title">{{routeData.view}} Folder</h1>
            <nuxeo-resource auto id="nuxeo" path="path/default-domain/UserWorkspaces/@children" response="{{docs}}"></nuxeo-resource>
            <div class="flex">
                <h2 class="contents-text">Contents</h2>
                <div class="sub-container">
                    <h3><span class="sub-title">Folders</span></h3>
                    <div class="folder-list">
                        <template is="dom-repeat" id="repeater" items="{{docs.entries}}"
                                filter="isFolder" observe="facets">
                            <div class="folders title" id="{{item.path}}" on-tap="viewResource">{{item.title}}</div>
                        </template>
                    </div>
                    <h3 id="file-title"><span class="sub-title">Files</span></h3>
                    <div class="file-list">
                        <template is="dom-repeat" items="{{docs.entries}}"
                                  filter="isFile" observe="facets">
                            <div class="files title" id="{{item.path}}" on-tap="viewResource">{{item.title}}</div>
                        </template>
                    </div>
                </div>
                <div class="create-new-content">
                    <paper-button raised toggles class="new" on-tap="openContentAdder">ADD CONTENT</paper-button>
                </div>
            </div>
        </div>

        <!--MODAL-->
        <paper-dialog id="contentAdder"
                      entry-animation="scale-up-animation"
                      exit-animation="fade-out-animation">

            <template is="dom-if" if="{{showDocumentUploader}}">
                <a href="/add-folder">
                    <paper-button raised noink class="new">ADD FOLDER</paper-button>
                </a>
                <a href="/add-file">
                    <paper-button raised noink class="new">ADD FILE</paper-button>
                </a>
            </template>
            <div class="buttons">
                <paper-button dialog-dismiss>Cancel</paper-button>
            </div>
        </paper-dialog>

    </template>

    <script>

        Polymer({

            is: 'my-root',

            showDocumentUploader: false,

            openContentAdder: function() {
                this.set('showDocumentUploader', true);
                this.$.contentAdder.open();
            },

            isFolder: function(entries) {
                return entries.facets.includes("Folderish");
            },

            viewResource: function(e) {
                let path = e.path["0"].id,
                    nuxeo = this.$.nuxeo;
                nuxeo.setAttribute('path', ("path" + path));
                this.replaceDomRepeat();
            },

            isFile: function(entries) {
                return entries.type == "File";
            },
            _folderView() {
                console.log('test')
            },

            replaceDomRepeat() {
                this.$.repeater.removeAttribute('filter');
                this.$.repeater.removeAttribute('observe');
            }
        });

    </script>

</dom-module>